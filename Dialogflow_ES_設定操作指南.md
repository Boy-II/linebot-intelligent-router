# Dialogflow ES è¨­å®šæ“ä½œæŒ‡å—

## å°ˆæ¡ˆæ¦‚è¿°
å»ºç«‹ä¼æ¥­å…§éƒ¨æ™ºèƒ½åŠ©ç†ï¼Œå”åŠ©å“¡å·¥é€éè‡ªç„¶èªè¨€è§¸ç™¼ N8N å·¥ä½œæµç¨‹ï¼ŒåŒ…å«è¡¨å–®å¡«å¯«ã€ç¶²ç«™åˆ†æç­‰åŠŸèƒ½ã€‚

## ç³»çµ±æ¶æ§‹
```
ç”¨æˆ¶è¼¸å…¥ â†’ Dialogflow ES â†’ Webhook â†’ N8N â†’ 
â”œâ”€â”€ ç”¨æˆ¶èº«ä»½è­˜åˆ¥ (users.json)
â”œâ”€â”€ æŒ‡ä»¤åŒ¹é… â†’ å°æ‡‰å·¥ä½œæµ
â””â”€â”€ LLM æ„åœ–åˆ¤æ–· â†’ æ™ºèƒ½å›æ‡‰
```

---

## ä¸€ã€åŸºç¤è¨­å®š

### 1.1 Webhook è¨­å®š
1. é€²å…¥ Dialogflow Console
2. å·¦å´é¸å–®é»æ“Š **ã€ŒFulfillmentã€**
3. å•Ÿç”¨ **ã€ŒWebhookã€**
4. è¨­å®š Webhook URLï¼š`https://your-n8n-domain.com/webhook/dialogflow`
5. é»æ“Š **ã€ŒSAVEã€**

### 1.2 æ¸¬è©¦è¨­å®š
1. å³å´æ¸¬è©¦å€åŸŸè¼¸å…¥ï¼šã€Œä½ å¥½ã€
2. ç¢ºèªæ©Ÿå™¨äººæœ‰å›æ‡‰
3. æª¢æŸ¥ N8N æ˜¯å¦æ”¶åˆ° webhook è«‹æ±‚

---

## äºŒã€ä¸»è¦ Intent å»ºç«‹

### 2.1 å•å€™ Intent
**Intent Name**: `greeting`

**Training Phrases**:
```
ä½ å¥½
æ—©å®‰
å—¨
å“ˆå›‰
è«‹å•æœ‰äººåœ¨å—
åˆå®‰
æ™šå®‰
```

**Responses**:
```
æ‚¨å¥½ï¼æˆ‘æ˜¯å…§éƒ¨åŠ©ç†æ©Ÿå™¨äººï¼Œå¯ä»¥å”åŠ©æ‚¨ï¼š
ğŸ“‹ å¡«å¯«å„ç¨®è¡¨å–®ç”³è«‹
ğŸ” åˆ†æç¶²ç«™è³‡æ–™
ğŸ“Š æŸ¥è©¢ç›¸é—œè³‡è¨Š
è«‹å‘Šè¨´æˆ‘æ‚¨éœ€è¦ä»€éº¼å”åŠ©ï¼Ÿ
```

**Webhook**: âœ“ å•Ÿç”¨

---

### 2.2 å°ˆæ¡ˆé€²ç¨¿å–® Intent
**Intent Name**: `command.project.form`

**Training Phrases**:
```
æˆ‘è¦å¡«å°ˆæ¡ˆé€²ç¨¿å–®
å¡«å¯«å°ˆæ¡ˆç”³è«‹
æ–°å¢å°ˆæ¡ˆ
å»ºç«‹å°ˆæ¡ˆç”³è«‹æ›¸
å°ˆæ¡ˆé€²ç¨¿
è¦å¡«å°ˆæ¡ˆè¡¨å–®
ç”³è«‹æ–°å°ˆæ¡ˆ
å»ºç«‹æ–°å°ˆæ¡ˆ
```

**Action and Parameters**:
- Action name: `fill_project_form`

**Responses**:
```
å¥½çš„ï¼æˆ‘ä¾†å”åŠ©æ‚¨å¡«å¯«å°ˆæ¡ˆé€²ç¨¿å–®
æ­£åœ¨ç‚ºæ‚¨æº–å‚™å°ˆæ¡ˆç”³è«‹è¡¨å–®ï¼Œè«‹ç¨ç­‰...
```

**Webhook**: âœ“ å•Ÿç”¨

---

### 2.3 ç¶²ç«™åˆ†æ Intent
**Intent Name**: `command.website.analysis`

**Training Phrases**:
```
æˆ‘è¦é€™ç¶²ç«™çš„è³‡æ–™ https://example.com
å¹«æˆ‘åˆ†æ https://google.com ç¶²ç«™
æŸ¥è©¢ https://apple.com çš„å…§å®¹
ç¸½çµé€™å€‹ç¶²ç«™ https://microsoft.com
çˆ¬å– https://facebook.com è³‡æ–™
åˆ†æç¶²ç«™ https://twitter.com
```

**Action and Parameters**:
- Action name: `analyze_website`
- Parameter name: `url`
- Entity type: `@sys.url`
- Required: âœ“
- Prompts: `è«‹æä¾›æ‚¨è¦åˆ†æçš„ç¶²ç«™ç¶²å€`

**Responses**:
```
æ”¶åˆ°ï¼æˆ‘ä¾†ç‚ºæ‚¨åˆ†æé€™å€‹ç¶²ç«™çš„å…§å®¹
æ­£åœ¨çˆ¬å–ç¶²ç«™è³‡æ–™ä¸¦é€²è¡Œåˆ†æï¼Œè«‹ç¨ç­‰...
```

**Webhook**: âœ“ å•Ÿç”¨

---

### 2.4 è«‹å‡ç”³è«‹ Intent
**Intent Name**: `command.leave.application`

**Training Phrases**:
```
æˆ‘è¦è«‹å‡
ç”³è«‹è«‹å‡
å¡«å¯«è«‹å‡å–®
è¦è«‹ç‰¹ä¼‘
ç”³è«‹ç—…å‡
æˆ‘æƒ³è«‹å‡
éœ€è¦è«‹å‡
```

**Action and Parameters**:
- Action name: `apply_leave`

**Responses**:
```
å¥½çš„ï¼æˆ‘ä¾†å”åŠ©æ‚¨ç”³è«‹è«‹å‡
æ­£åœ¨æº–å‚™è«‹å‡ç”³è«‹è¡¨å–®...
```

**Webhook**: âœ“ å•Ÿç”¨

---

### 2.5 å ±éŠ·ç”³è«‹ Intent
**Intent Name**: `command.expense.claim`

**Training Phrases**:
```
æˆ‘è¦å ±éŠ·
ç”³è«‹å ±éŠ·
å¡«å¯«å ±éŠ·å–®
è²»ç”¨å ±éŠ·
è¦å ±å¸³
å ±éŠ·è²»ç”¨
```

**Action and Parameters**:
- Action name: `expense_claim`

**Responses**:
```
å¥½çš„ï¼æˆ‘ä¾†å”åŠ©æ‚¨ç”³è«‹è²»ç”¨å ±éŠ·
æ­£åœ¨æº–å‚™å ±éŠ·ç”³è«‹è¡¨å–®...
```

**Webhook**: âœ“ å•Ÿç”¨

---

### 2.6 Fallback Intent (LLM åˆ¤æ–·)
**ä½¿ç”¨é è¨­çš„ Default Fallback Intent**

**Training Phrases**: (ä¿æŒé è¨­)

**Responses**:
```
è®“æˆ‘äº†è§£æ‚¨çš„éœ€æ±‚...
æ­£åœ¨åˆ†ææ‚¨çš„è«‹æ±‚ï¼Œè«‹ç¨ç­‰...
```

**Action and Parameters**:
- Action name: `llm_intent_analysis`

**Webhook**: âœ“ å•Ÿç”¨

---

## ä¸‰ã€å¯¦é«” (Entities) è¨­å®š

### 3.1 å°ˆæ¡ˆé¡å‹å¯¦é«”
**Entity Name**: `@project-type`

**Entity Values**:
```
è¨­è¨ˆå°ˆæ¡ˆ: è¨­è¨ˆ, design, è¦–è¦º, å¹³é¢
é–‹ç™¼å°ˆæ¡ˆ: é–‹ç™¼, development, ç¨‹å¼, ç³»çµ±
è¡ŒéŠ·å°ˆæ¡ˆ: è¡ŒéŠ·, marketing, æ¨å»£, æ´»å‹•
ç ”ç©¶å°ˆæ¡ˆ: ç ”ç©¶, research, èª¿æŸ¥, åˆ†æ
```

### 3.2 éƒ¨é–€å¯¦é«”
**Entity Name**: `@department`

**Entity Values**:
```
è¡ŒéŠ·éƒ¨: è¡ŒéŠ·, marketing, æ¥­å‹™
æŠ€è¡“éƒ¨: æŠ€è¡“, IT, å·¥ç¨‹, é–‹ç™¼
è²¡å‹™éƒ¨: è²¡å‹™, æœƒè¨ˆ, finance
äººè³‡éƒ¨: äººè³‡, HR, äººäº‹
```

---

## å››ã€é€²éšè¨­å®š

### 4.1 Context è¨­å®š
ç”¨æ–¼å¤šè¼ªå°è©±ç®¡ç†ï¼š

**å¡«å¯«è¡¨å–® Context**:
- Input Context: `awaiting-form-data`
- Output Context: `form-in-progress` (lifespan: 5)

**ç¶²ç«™åˆ†æ Context**:
- Input Context: `awaiting-url`
- Output Context: `analysis-in-progress` (lifespan: 3)

### 4.2 Events è¨­å®š
**WELCOME Event**:
- åœ¨ greeting Intent ä¸­æ–°å¢ Event: `WELCOME`
- ç”¨æ–¼å°è©±é–‹å§‹æ™‚è‡ªå‹•è§¸ç™¼

### 4.3 Small Talk
1. å·¦å´é¸å–®é»æ“Š **ã€ŒSmall Talkã€**
2. å•Ÿç”¨å¸¸è¦‹çš„é–’èŠåŠŸèƒ½ï¼š
   - Greetings
   - Courtesy
   - About agent
3. è‡ªè¨‚å›æ‡‰å…§å®¹

---

## äº”ã€æ¸¬è©¦èˆ‡é©—è­‰

### 5.1 åŸºæœ¬æ¸¬è©¦
åœ¨å³å´æ¸¬è©¦å€åŸŸæ¸¬è©¦ä»¥ä¸‹èªå¥ï¼š

**å•å€™æ¸¬è©¦**:
```
ä½ å¥½
æ—©å®‰
å“ˆå›‰
```

**åŠŸèƒ½æ¸¬è©¦**:
```
æˆ‘è¦å¡«å°ˆæ¡ˆé€²ç¨¿å–®
å¹«æˆ‘åˆ†æ https://google.com
æˆ‘è¦è«‹å‡
éœ€è¦å ±éŠ·
```

**Fallback æ¸¬è©¦**:
```
å¹«æˆ‘æŸ¥è©¢ä»Šå¤©çš„å¤©æ°£
æˆ‘æƒ³çŸ¥é“å…¬å¸æ”¿ç­–
```

### 5.2 Webhook æ¸¬è©¦
1. ç¢ºèªæ¯å€‹ Intent éƒ½æœ‰æ­£ç¢ºè§¸ç™¼ webhook
2. æª¢æŸ¥ N8N æ”¶åˆ°çš„è³‡æ–™æ ¼å¼
3. é©—è­‰ç”¨æˆ¶èº«ä»½è­˜åˆ¥åŠŸèƒ½

---

## å…­ã€ç”¨æˆ¶è³‡æ–™æ•´åˆ

### 6.1 ç”¨æˆ¶è³‡æ–™çµæ§‹
åŸºæ–¼ `/linebot/data/users/users.json`ï¼š

```json
{
  "userInfo": {
    "line_id": "U1234567890abcdef",
    "name": "ç‹å°æ˜",
    "department": "è¡ŒéŠ·éƒ¨",
    "title": "å°ˆæ¡ˆç¶“ç†",
    "email": "wang.xiaoming@gmail.com",
    "tags": ["VIP", "ç®¡ç†å±¤"]
  }
}
```

### 6.2 LLM ç”¨æˆ¶ä¸Šä¸‹æ–‡
```
ç”¨æˆ¶è³‡è¨Šï¼š
- å§“åï¼šç‹å°æ˜
- éƒ¨é–€ï¼šè¡ŒéŠ·éƒ¨
- è·ä½ï¼šå°ˆæ¡ˆç¶“ç†
- æ¨™ç±¤ï¼šVIP, ç®¡ç†å±¤

ç”¨æˆ¶è«‹æ±‚ï¼š[ç”¨æˆ¶è¼¸å…¥å…§å®¹]

è«‹æ ¹æ“šç”¨æˆ¶çš„è·ä½å’Œéƒ¨é–€ï¼Œæä¾›é©åˆçš„å›æ‡‰ã€‚
```

---

## ä¸ƒã€å¸¸è¦‹å•é¡Œæ’é™¤

### 7.1 Webhook ç„¡å›æ‡‰
1. æª¢æŸ¥ Fulfillment URL æ˜¯å¦æ­£ç¢º
2. ç¢ºèª N8N webhook node æ­£åœ¨é‹è¡Œ
3. æª¢æŸ¥é˜²ç«ç‰†è¨­å®š

### 7.2 Intent ç„¡æ³•åŒ¹é…
1. å¢åŠ æ›´å¤š Training Phrases
2. æª¢æŸ¥ç”¨è©æ˜¯å¦èˆ‡ç”¨æˆ¶ç¿’æ…£ä¸€è‡´
3. èª¿æ•´ ML Classification Threshold

### 7.3 åƒæ•¸æå–å¤±æ•—
1. æª¢æŸ¥å¯¦é«”é¡å‹è¨­å®š
2. ç¢ºèª Training Phrases ä¸­æœ‰æ¨™è¨˜å¯¦é«”
3. æ¸¬è©¦ä¸åŒçš„è¼¸å…¥æ ¼å¼

---

## å…«ã€éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### 8.1 è¨­å®šå®Œæˆç¢ºèª
- [ ] Webhook URL è¨­å®šæ­£ç¢º
- [ ] æ‰€æœ‰ä¸»è¦ Intent å»ºç«‹å®Œæˆ
- [ ] Training Phrases å……è¶³ (æ¯å€‹ Intent è‡³å°‘ 10 å€‹)
- [ ] Webhook å•Ÿç”¨æ–¼æ‰€æœ‰å¿…è¦ Intent
- [ ] å¯¦é«”è¨­å®šå®Œæˆ
- [ ] æ¸¬è©¦é€šé

### 8.2 æ•´åˆæ¸¬è©¦
- [ ] N8N å·¥ä½œæµæ¥æ”¶æ­£å¸¸
- [ ] ç”¨æˆ¶èº«ä»½è­˜åˆ¥æ­£ç¢º
- [ ] è¡¨å–®è§¸ç™¼æ­£å¸¸
- [ ] ç¶²ç«™åˆ†æåŠŸèƒ½æ­£å¸¸
- [ ] LLM å›æ‡‰ç¬¦åˆé æœŸ

### 8.3 ç”¨æˆ¶é«”é©—å„ªåŒ–
- [ ] å›æ‡‰æ™‚é–“åˆç† (<3ç§’)
- [ ] éŒ¯èª¤è™•ç†å®Œå–„
- [ ] å›æ‡‰å…§å®¹å‹å–„
- [ ] å¤šè¼ªå°è©±æµæš¢

---

## ä¹ã€ç¶­è­·èˆ‡æ›´æ–°

### 9.1 å®šæœŸæª¢æŸ¥
- æ¯é€±æª¢æŸ¥ Intent å‘½ä¸­ç‡
- æ¯æœˆæ›´æ–° Training Phrases
- å­£åº¦æª¢è¦–ç”¨æˆ¶åé¥‹

### 9.2 æ•ˆèƒ½ç›£æ§
- ä½¿ç”¨ Dialogflow Analytics
- ç›£æ§ webhook å›æ‡‰æ™‚é–“
- è¿½è¹¤ç”¨æˆ¶æ»¿æ„åº¦

### 9.3 åŠŸèƒ½æ“´å±•
- æ ¹æ“šç”¨æˆ¶éœ€æ±‚æ–°å¢ Intent
- å„ªåŒ– LLM åˆ¤æ–·é‚è¼¯
- æ•´åˆæ›´å¤šå…§éƒ¨ç³»çµ±

---

## åã€è¯çµ¡è³‡è¨Š

**æŠ€è¡“æ”¯æ´**: [æ‚¨çš„è¯çµ¡æ–¹å¼]
**æ–‡ä»¶æ›´æ–°**: 2025-06-04
**ç‰ˆæœ¬**: 1.0

---

*æ­¤æŒ‡å—åŸºæ–¼ Dialogflow ES ç‰ˆæœ¬ï¼Œå¦‚éœ€ CX ç‰ˆæœ¬è«‹å¦è¡Œè¦åŠƒã€‚*